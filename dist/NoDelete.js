function D(e){window.enmity.plugins.registerPlugin(e)}function f(e,t){return window.enmity.modules.getModule(e,t)}function i(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function h(e){return window.enmity.patcher.create(e)}var E="NoDelete",M="1.2.0",w='Basic "Message Logger"',S=[{name:"NotMarek",id:"206299359007080450"}],v="#ff0069",A={name:E,version:M,description:w,authors:S,color:v};function a(e){return window.enmity.assets.getIDByName(e)}const l=h("NoDelete"),r=f(e=>e.open!==void 0&&e.close!==void 0&&!e.openLazy&&!e.startDrag&&!e.init&&!e.openReplay&&!e.openChannelCallPopout),N={...A,patches:[],onStart(){const e=i("_currentDispatchActionType","_subscriptions","_waitQueue");let t=0,c=3;const g=()=>{try{t++;const u=i("getMessage","getMessages"),m=i("getChannel","getDMFromUserId"),d=i("_currentDispatchActionType","_subscriptions","_waitQueue");console.log(`NoDelete delayed start attempt ${t}/${c}.`),r.open({content:`NoDelete start attempt ${t}/${c}.`,source:a("ic_staff_guild_icon_blurple")});const p=d._orderedActionHandlers.MESSAGE_DELETE.find(s=>s.name==="MessageStore"),_=d._orderedActionHandlers.MESSAGE_UPDATE.find(s=>s.name==="MessageStore");l.before(p,"actionHandler",(s,n)=>{const o=u.getMessage(n[0].channelId,n[0].id);if(n[0]={},!o.editedTimestamp||o.editedTimestamp._isValid){const y={type:"MESSAGE_UPDATE",message:{...o,edited_timestamp:"invalid_timestamp",content:o.content+" `[deleted]`",guild_id:m.getChannel(o.channel_id).guild_id}};d.dispatch(y)}}),l.before(_,"actionHandler",(s,n)=>{try{const o=u.getMessage(n[0].message.channel_id,n[0].message.id);try{if(!n[0].edited_timestamp._isValid)return}catch{}n[0].message.content=o.content+" `[edited]`\n"+n[0].message.content;return}catch{}}),console.log("NoDelete delayed start successful."),r.open({content:"NoDelete delayed start successful.",source:a("Check")})}catch{t<c?(console.warn(`NoDelete failed to start. Trying again in ${t}0s.`),r.open({content:`NoDelete failed to start trying again in ${t}0s.`,source:a("ic_message_retry")}),setTimeout(g,t*1e4)):(console.error("NoDelete failed to start. Giving up."),r.open({content:"NoDelete failed to start. Giving up.",source:a("Small")}))}};e.dispatch({type:"MESSAGE_UPDATE",message:{edited_timestamp:"",content:"",guild_id:"0000000"}}),e.dispatch({type:"MESSAGE_DELETE",message:{channel_id:"",id:""}}),setTimeout(()=>{g()},300)},onStop(){l.unpatchAll()}};D(N);
