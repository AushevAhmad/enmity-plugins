function _(t){window.enmity.plugins.registerPlugin(t)}function a(...t){return window.enmity.modules.getByProps(...t)}window.enmity.modules.common;function E(t){return window.enmity.patcher.create(t)}var h="NoDelete",y="1.1.5",M='Basic "Message Logger"',S=[{name:"NotMarek",id:"206299359007080450"}],f="#ff0069",A={name:h,version:y,description:M,authors:S,color:f};const r=E("NoDelete"),D={...A,patches:[],onStart(){const t=a("_currentDispatchActionType","_subscriptions","_waitQueue");let i=0,d=3;const c=()=>{try{i++;const l=a("getMessage","getMessages"),g=a("getChannel","getDMFromUserId"),o=a("_currentDispatchActionType","_subscriptions","_waitQueue");console.log(`NoDelete delayed start attempt ${i}/${d}.`);const m=o._orderedActionHandlers.MESSAGE_DELETE.find(s=>s.name==="MessageStore"),p=o._orderedActionHandlers.MESSAGE_UPDATE.find(s=>s.name==="MessageStore");r.before(m,"actionHandler",(s,e)=>{const n=l.getMessage(e[0].channelId,e[0].id);if(e[0]={},!n.editedTimestamp||n.editedTimestamp._isValid){const u={type:"MESSAGE_UPDATE",message:{...n,edited_timestamp:"invalid_timestamp",content:n.content+" `[deleted]`",guild_id:g.getChannel(n.channel_id).guild_id}};o.dispatch(u)}}),r.before(p,"actionHandler",(s,e)=>{try{const n=l.getMessage(e[0].message.channel_id,e[0].message.id);try{if(!e[0].edited_timestamp._isValid)return}catch{}e[0].message.content=n.content+" `[edited]`\n"+e[0].message.content;return}catch{}})}catch{i<d?(console.warn(`NoDelete failed to start. Trying again in ${i}s.`),setTimeout(c,i*1e3)):console.error("NoDelete failed to start. Giving up.")}};t.dispatch({type:"MESSAGE_UPDATE",message:{edited_timestamp:"",content:"",guild_id:"0000000"}}),t.dispatch({type:"MESSAGE_DELETE",message:{channel_id:"",id:""}}),setTimeout(()=>{c()},300)},onStop(){r.unpatchAll()}};_(D);
