function _(t){window.enmity.plugins.registerPlugin(t)}function a(...t){return window.enmity.modules.getByProps(...t)}window.enmity.modules.common;function E(t){return window.enmity.patcher.create(t)}var h="NoDelete",y="1.1.5",D='Basic "Message Logger"',f=[{name:"NotMarek",id:"206299359007080450"}],M="#ff0069",S={name:h,version:y,description:D,authors:f,color:M};const r=E("NoDelete"),A={...S,patches:[],onStart(){const t=a("_currentDispatchActionType","_subscriptions","_waitQueue");let s=0,c=3;const d=()=>{try{s++;const l=a("getMessage","getMessages"),g=a("getChannel","getDMFromUserId"),o=a("_currentDispatchActionType","_subscriptions","_waitQueue");console.log(`NoDelete delayed start attempt ${s}/${c}.`);const m=o._orderedActionHandlers.MESSAGE_DELETE.find(i=>i.name==="MessageStore"),u=o._orderedActionHandlers.MESSAGE_UPDATE.find(i=>i.name==="MessageStore");r.before(m,"actionHandler",(i,e)=>{const n=l.getMessage(e[0].channelId,e[0].id);if(e[0]={},!n.editedTimestamp||n.editedTimestamp._isValid){const p={type:"MESSAGE_UPDATE",message:{...n,edited_timestamp:"invalid_timestamp",content:n.content+" `[deleted]`",guild_id:g.getChannel(n.channel_id).guild_id}};o.dispatch(p)}}),r.before(u,"actionHandler",(i,e)=>{try{const n=l.getMessage(e[0].message.channel_id,e[0].message.id);try{if(!e[0].edited_timestamp._isValid)return}catch{}e[0].message.content=n.content+" `[edited]`\n"+e[0].message.content;return}catch{}}),console.log("NoDelete delayed start successful.")}catch{s<c?(console.warn(`NoDelete failed to start. Trying again in ${s}s.`),setTimeout(d,s*1e3)):console.error("NoDelete failed to start. Giving up.")}};t.dispatch({type:"MESSAGE_UPDATE",message:{edited_timestamp:"",content:"",guild_id:"0000000"}}),t.dispatch({type:"MESSAGE_DELETE",message:{channel_id:"",id:""}}),setTimeout(()=>{d()},300)},onStop(){r.unpatchAll()}};_(A);
