function y(e){window.enmity.plugins.registerPlugin(e)}function h(e,o){return window.enmity.modules.getModule(e,o)}function a(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function D(e){return window.enmity.patcher.create(e)}var f="NoDelete",E="1.2.2",M='Basic "Message Logger"',w=[{name:"NotMarek",id:"206299359007080450"}],S="#ff0069",v="https://raw.githubusercontent.com/notmarek/enmity-plugins/master/dist/NoDelete.js",N={name:f,version:E,description:M,authors:w,color:S,sourceUrl:v};function r(e){return window.enmity.assets.getIDByName(e)}const d=D("NoDelete"),c=h(e=>e.open!==void 0&&e.close!==void 0&&!e.openLazy&&!e.startDrag&&!e.init&&!e.openReplay&&!e.openChannelCallPopout),A={...N,patches:[],onStart(){a("_currentDispatchActionType","_subscriptions","_waitQueue");let e=0,o=3;const l=()=>{try{s.dispatch({type:"MESSAGE_UPDATE",message:{edited_timestamp:"",content:"",guild_id:"0000000"}}),s.dispatch({type:"MESSAGE_DELETE",message:{channel_id:"",id:""}}),e++;const u=a("getMessage","getMessages"),g=a("getChannel","getDMFromUserId"),s=a("_currentDispatchActionType","_subscriptions","_waitQueue");console.log(`NoDelete delayed start attempt ${e}/${o}.`),c.open({content:`NoDelete start attempt ${e}/${o}.`,source:r("ic_staff_guild_icon_blurple")});const m=s._orderedActionHandlers.MESSAGE_DELETE.find(i=>i.name==="MessageStore"),p=s._orderedActionHandlers.MESSAGE_UPDATE.find(i=>i.name==="MessageStore");d.before(m,"actionHandler",(i,t)=>{const n=u.getMessage(t[0].channelId,t[0].id);if(t[0]={},!n.editedTimestamp||n.editedTimestamp._isValid){const _={type:"MESSAGE_UPDATE",message:{...n,edited_timestamp:"invalid_timestamp",content:n.content+" `[deleted]`",guild_id:g.getChannel(n.channel_id).guild_id}};s.dispatch(_)}}),d.before(p,"actionHandler",(i,t)=>{try{const n=u.getMessage(t[0].message.channel_id,t[0].message.id);try{if(!t[0].edited_timestamp._isValid)return}catch{}t[0].message.content=n.content+" `[edited]`\n"+t[0].message.content;return}catch{}}),console.log("NoDelete delayed start successful."),c.open({content:"NoDelete delayed start successful.",source:r("Check")})}catch{e<o?(console.warn(`NoDelete failed to start. Trying again in ${e}0s.`),c.open({content:`NoDelete failed to start trying again in ${e}0s.`,source:r("ic_message_retry")}),setTimeout(l,e*1e4)):(console.error("NoDelete failed to start. Giving up."),c.open({content:"NoDelete failed to start. Giving up.",source:r("Small")}))}};setTimeout(()=>{l()},300)},onStop(){d.unpatchAll()}};y(A);
